<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fetch Data and Display Result</title>
</head>
<body>

    <h1>Fetch Data from URL</h1>
    
    <!-- Input field to take the initial URL -->
    <input type="text" id="urlInput" placeholder="Enter the initial URL" size="50">
    <button onclick="fetchData()">Fetch</button>

    <!-- Output for the final response -->
    <h2>Response</h2>
    <pre id="output"></pre>

    <script>
        async function fetchData() {
            // Get the input URL
            const url = document.getElementById('urlInput').value;

            if (!url) {
                alert("Please enter a valid URL");
                return;
            }

            try {
                // Step 1: Fetch data from the initial URL
                const response = await fetch(url);
                const data = await response.json();

                // Extract lic_keyId and lic_key
                const keyid = data.lic_keyId;
                const key = data.lic_key;

                if (!keyid || !key) {
                    throw new Error("lic_keyId or lic_key not found in the response.");
                }

                // Step 2: Prepare the second URL with keyid and key
                const finalUrl = `https://vercel-php-clearkey-hex-base64-json.vercel.app/api/results.php?keyid=${encodeURIComponent(keyid)}&key=${encodeURIComponent(key)}`;

                // Step 3: Fetch data from the final URL
                const finalResponse = await fetch(finalUrl);
                const finalData = await finalResponse.json();

                // Display the final response
                document.getElementById('output').textContent = JSON.stringify(finalData, null, 2);

            } catch (error) {
                // Display error message if something goes wrong
                document.getElementById('output').textContent = `Error: ${error.message}`;
            }
        }
    </script>

</body>
</html>
