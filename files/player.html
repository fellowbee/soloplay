<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Widevine Video Player</title>
    <script src="https://content.jwplatform.com/libraries/KB5zFt7A.js"></script>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            overflow: hidden;
        }
        #player-container {
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body>
    <div id="player-container"></div>

    <script>
        // Function to get query parameters from URL
        function getQueryParams() {
            const urlParams = new URLSearchParams(window.location.search);
            return {
                ottplay_id: urlParams.get('ottplay_id'),
                provider: urlParams.get('provider'),
                content_type: urlParams.get('content_type')
            };
        }

        // Get dynamic parameters from the URL
        const { ottplay_id, provider, content_type } = getQueryParams();

        // Ensure all parameters are provided
        if (!ottplay_id || !provider || !content_type) {
            alert('Missing parameters: ottplay_id, provider, or content_type');
            throw new Error('Missing parameters');
        }

        // Construct the API URL with the dynamic parameters
        const api_url = `https://oneplay-nine.vercel.app/api/videoplayer?ottplay_id=${ottplay_id}&provider=${provider}&content_type=${content_type}`;

        // Fetch video data from the API
        fetch(api_url)
            .then(response => {
                if (!response.ok) {
                    throw new Error('Error fetching video data');
                }
                return response.json();
            })
            .then(data => {
                // Extract playback URL and license URL
                const playback_url = data?.playback?.[0]?.playback_url;
                const license_url = data?.playback?.[0]?.keys?.[0]?.license_url;

                // Ensure we have valid data
                if (!playback_url || !license_url) {
                    throw new Error('Invalid video data: Missing playback_url or license_url');
                }

                // Initialize JWPlayer
                jwplayer("player-container").setup({
                    playlist: [{
                        sources: [{
                            file: playback_url,
                            type: 'application/dash+xml',
                            drm: {
                                widevine: {
                                    url: license_url
                                }
                            },
                            default: true,
                        }]
                    }],
                    width: "100%",
                    height: "100%",
                    aspectratio: "16:9",
                    autostart: true,
                    stretching: "uniform",
                    fullscreen: true, // Enable fullscreen mode
                    controls: true
                });

                // Enable fullscreen on mobile devices in landscape mode
                var videoPlayer = document.querySelector("#player-container");
                videoPlayer.addEventListener("click", function() {
                    if (window.innerWidth > window.innerHeight) {
                        document.fullscreenElement || document.documentElement.requestFullscreen();
                    }
                });

            })
            .catch(error => {
                console.error('Error:', error);
                alert('An error occurred while fetching the video data.');
            });
    </script>
</body>
</html>
