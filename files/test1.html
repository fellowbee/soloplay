<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stream Fetcher</title>
    <script src="https://cdn.jwplayer.com/libraries/YOUR_JWPLAYER_KEY.js"></script> <!-- Replace with your JW Player key -->
</head>
<body>

<h1>Stream Data Response</h1>
<div id="player" style="width: 100%; height: 400px;"></div>
<div id="response"></div>
<div id="license"></div>

<script>
    async function fetchData() {
        const urlParams = new URLSearchParams(window.location.search);
        const contentId = urlParams.get('id');

        if (!contentId) {
            document.getElementById('response').textContent = 'Content ID not found in the URL.';
            return;
        }

        const url = `https://axstream.vercel.app/getStream?id=${contentId}&uid=svYiu9E_S2bl0aaLW0&token=dOweSI7QmWPTKtHG0EYoSKBd1lE%3D&authToken=E6sB%2FGzpUQeLBMXhinXjTyiLl25zVFSQZEMw4rsPOSLX4b34TxuMICZSSyvccnXz&did=86f26b76-66e6-49c0-808a-aad7bedbf4cc`;

        try {
            const response = await fetch(url, { method: 'GET' });
            
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }

            const data = await response.json();
            const playbackUrl = data.playback ? data.playback.playUrl : null;
            const licenseUrl = data.drm ? data.drm.url : null;
            const certificateUrl = data.certificate ? data.certificate.url : null;

            // Display the URLs
            document.getElementById('response').textContent = playbackUrl || 'Playback URL not found.';
            document.getElementById('license').textContent = licenseUrl || 'License URL not found.';

            // Set up JW Player after fetching URLs
            if (playbackUrl) {
                jwplayer("player").setup({
                    playlist: [{
                        sources: [{
                            file: playbackUrl,
                            type: 'application/dash+xml',
                            drm: {
                                fairplay: {
                                    certificateUrl: certificateUrl,
                                    processSpcUrl: licenseUrl,
                                    licenseResponseType: 'json',
                                    licenseRequestHeaders: [
                                        {
                                            name: 'Content-type', value: 'application/json'
                                        }
                                    ],
                                }
                            },
                            default: true,
                        }]
                    }],
                    width: "100%",
                    height: "100%",
                    aspectratio: "16:9",
                    controls: true,
                    autostart: true,
                }).on('error', function(event) {
                    console.error("Error occurred: ", event);
                });
            } else {
                document.getElementById('player').innerHTML = 'No video URL provided.';
            }
        } catch (error) {
            document.getElementById('response').textContent = `Error: ${error.message}`;
        }
    }

    // Automatically fetch data on page load
    fetchData();
</script>

</body>
</html>
